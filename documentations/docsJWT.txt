

Your final folder structure:

project/
тФЬтФАтФА config/
тФВ   тФФтФАтФА db.js
тФЬтФАтФА controllers/
тФВ   тФФтФАтФА userController.js
тФВ   тФФтФАтФА authController.js
тФЬтФАтФА middleware/
тФВ   тФФтФАтФА hashPassword.js
тФВ   тФФтФАтФА authMiddleware.js
тФЬтФАтФА models/
тФВ   тФФтФАтФА userModel.js
тФЬтФАтФА routes/
тФВ   тФФтФАтФА userRoutes.js
тФВ   тФФтФАтФА authRoutes.js
тФЬтФАтФА .env
тФФтФАтФА server.js

---------
ржПржЗ ?. ржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ?
req.headers.authorization?.split(' ')

ржПржЗ ?. рж╣рж▓рзЛ optional chaining

ржорж╛ржирзЗ:

ЁЯСЙ ржпржжрж┐ authorization ржирж╛ ржерж╛ржХрзЗ
тЖТ рждрж╛рж╣рж▓рзЗ error ржирж╛ ржжрж┐рзЯрзЗ undefined рж░рж┐ржЯрж╛рж░рзНржи ржХрж░ржмрзЗ

ржирж╛ рж╣рж▓рзЗ crash ржХрж░ржд тЭМ

-----------

explanation of   .split(' ')[1];

Server ржП ржПржЯрж╛ ржПржоржиржнрж╛ржмрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯ: req.headers.authorization
ржПрж░ value рж╣ржмрзЗ: "Bearer abc123token"
рж▓ржХрзНрж╖рзНржп ржХрж░рзЛ тАФ ржПржЦрж╛ржирзЗ ржжрзБржЗржЯрж╛ рж╢ржмрзНржж ржЖржЫрзЗ
Bearer + abc123token
ржорж╛ржЭржЦрж╛ржирзЗ ржПржХржЯрж╛ space ржЖржЫрзЗ

split(' ') ржорж╛ржирзЗ: ржпрзЗржЦрж╛ржирзЗ ржпрзЗржЦрж╛ржирзЗ space ржЖржЫрзЗ рж╕рзЗржЦрж╛ржирзЗ ржХрзЗржЯрзЗ array ржмрж╛ржирж╛ржУ

for Example: "Bearer abc123token".split(' ')
Result рж╣ржмрзЗ: ["Bearer", "abc123token"]

ржорж╛ржирзЗ:

Index	Value
0	    "Bearer"
1	    "abc123token"
ЁЯФ╣ рждрж╛рж╣рж▓рзЗ [1] ржХрзЗржи?

ржХрж╛рж░ржг ржЖржорж░рж╛ рж╢рзБржзрзБ token ржЪрж╛ржЗ mane [1] ta chai
0 or Bearer ржжрж░ржХрж╛рж░ ржирж╛ржЗ

---------


jwt.verify() рждрж┐ржиржЯрж╛ ржХрж╛ржЬ ржХрж░рзЗ:

1. Token ржПрж░ signature check ржХрж░рзЗ

ржжрзЗржЦрзЗ ржПржЯрж╛ ржЖрж╕рж▓рзЗржЗ рждрзЛржорж╛рж░ server ржмрж╛ржирж┐рзЯрзЗржЫрзЗ ржХрж┐ржирж╛

2. Token expire рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛ check ржХрж░рзЗ
3. Token ржПрж░ ржнрж┐рждрж░рзЗрж░ data ржмрзЗрж░ ржХрж░рзЗ


-------

Token ржПрж░ ржнрж┐рждрж░рзЗ ржХрзА ржерж╛ржХрзЗ?

ржпржЦржи рждрзБржорж┐ login ржП token ржмрж╛ржирж╛ржУ:

jwt.sign(
  { id: user._id, role: "user" },
  process.env.JWT_SECRET,
  { expiresIn: '7d' }
);

Token ржПрж░ ржнрж┐рждрж░рзЗ payload ржерж╛ржХрзЗ:

{
  "id": "65abc123...",
  "role": "user",
  "iat": 1700000000,
  "exp": 1700600000
}

--------

рждрж╛рж╣рж▓рзЗ decoded ржХрзА рж╣ржмрзЗ?
const decoded = jwt.verify(token, process.env.JWT_SECRET);

ЁЯСЙ decoded рж╣ржмрзЗ рж╕рзЗржЗ payload object

for Example:

decoded = {
  id: "65abc123...",
  role: "user",
  iat: 1700000000,
  exp: 1700600000
}

---------

Step 2: req.user = decoded; ржХрзЗржи?
req.user = decoded;

ржПржЯрж╛ ржЦрзБржм ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ЁЯФе

ЁЯСЙ ржЖржорж░рж╛ decoded data request ржПрж░ рж╕рж╛ржерзЗ attach ржХрж░ржЫрж┐
ЁЯСЙ ржпрж╛рждрзЗ ржкрж░рзЗрж░ route/controller ржПржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗ

---------
рж╕рж╣ржЬ ржнрж╛рж╖рж╛рзЯ ржкрзБрж░рзЛ ржмрж┐рж╖рзЯржЯрж╛ - рж▓рж╛ржЗржи ржХрзА ржХрж░ржЫрзЗ
1. jwt.verify()	- Token ржЖрж╕рж▓ ржХрж┐ржирж╛ check + ржнрж┐рждрж░рзЗрж░ data ржмрзЗрж░
2. decoded	- Token ржПрж░ payload
3. req.user = decoded	- рж╕рзЗржЗ data request ржП attach

ЁЯФе Real-life analogy ржнрж╛ржмрзЛ:

JWT = ID card

jwt.verify() = ржЧрж╛рж░рзНржб ID check ржХрж░ржЫрзЗ

decoded = ID card ржП рж▓рзЗржЦрж╛ рждржерзНржп

req.user = ржЧрж╛рж░рзНржб рждрзЛржорж╛рж░ рждржерзНржп system ржП ржврзБржХрж┐рзЯрзЗ ржжрж┐рж▓